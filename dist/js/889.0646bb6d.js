"use strict";(self["webpackChunkresearch_task_manager"]=self["webpackChunkresearch_task_manager"]||[]).push([[889],{4114:function(e,l,t){var a=t(6518),s=t(8981),o=t(6198),r=t(4527),n=t(6837),i=t(9039),d=i((function(){return 4294967297!==[].push.call({length:4294967296},1)})),c=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},k=d||!c();a({target:"Array",proto:!0,arity:1,forced:k},{push:function(e){var l=s(this),t=o(l),a=arguments.length;n(t+a);for(var i=0;i<a;i++)l[t]=arguments[i],t++;return r(l,t),t}})},4376:function(e,l,t){var a=t(2195);e.exports=Array.isArray||function(e){return"Array"===a(e)}},4527:function(e,l,t){var a=t(3724),s=t(4376),o=TypeError,r=Object.getOwnPropertyDescriptor,n=a&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=n?function(e,l){if(s(e)&&!r(e,"length").writable)throw new o("Cannot set read only .length");return e.length=l}:function(e,l){return e.length=l}},6837:function(e){var l=TypeError,t=9007199254740991;e.exports=function(e){if(e>t)throw l("Maximum allowed index exceeded");return e}},9889:function(e,l,t){t.r(l),t.d(l,{default:function(){return N}});var a=t(641),s=t(33),o=t(3751);const r={class:"fade-in"},n={class:"flex justify-between items-center mb-6"},i={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},d=["src","alt"],c={class:"p-4"},k={class:"text-lg font-semibold text-gray-800"},u={class:"text-sm text-gray-600 mt-2"},f={class:"flex justify-between mt-4 pt-4 border-t border-gray-100"},w=["onClick"],p=["onClick"],b={key:0,class:"lg:col-span-3 text-center py-12 bg-white rounded-lg shadow-md"},m={class:"modal-content"},v={class:"flex justify-between items-center mb-4"},g={class:"text-xl font-bold text-gray-800"},h=["src","alt"],y={class:"mb-4"},L={class:"mb-4"},x={class:"mb-4"},W={class:"mb-4"},C={class:"bg-gray-50 p-3 rounded-lg max-h-40 overflow-y-auto mb-2"},T={key:0,class:"text-gray-500 text-sm"},R=["onClick"],E={class:"flex"},K={class:"flex justify-between"},U={class:"modal-content"},j={class:"flex justify-between items-center mb-4"},D={class:"mb-4"},A={class:"mb-4"},X={class:"mb-4"},_={class:"flex justify-end"},M=["disabled"],V={key:0,class:"fas fa-spinner fa-spin ml-1"};function $(e,l,t,$,F,J){return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.Lk)("div",n,[l[21]||(l[21]=(0,a.Lk)("h1",{class:"text-2xl font-bold text-gray-800"},"مخططات سير العمل",-1)),(0,a.Lk)("button",{onClick:l[0]||(l[0]=e=>$.showAddWorkflowModal=!0),class:"btn btn-primary"},l[20]||(l[20]=[(0,a.Lk)("i",{class:"fas fa-plus ml-2"},null,-1),(0,a.eW)("إضافة مخطط جديد ")]))]),(0,a.Lk)("div",i,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)($.workflows,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"card hover:shadow-lg transition-shadow duration-200"},[(0,a.Lk)("img",{src:e.imageUrl,alt:e.title,class:"w-full h-48 object-cover rounded-t-lg"},null,8,d),(0,a.Lk)("div",c,[(0,a.Lk)("h3",k,(0,s.v_)(e.title),1),(0,a.Lk)("p",u,(0,s.v_)(e.description),1),(0,a.Lk)("div",f,[(0,a.Lk)("button",{onClick:l=>$.openWorkflowDetails(e),class:"text-primary-600 hover:text-primary-800"},l[22]||(l[22]=[(0,a.Lk)("i",{class:"fas fa-info-circle ml-1"},null,-1),(0,a.eW)("التفاصيل ")]),8,w),(0,a.Lk)("button",{onClick:l=>$.deleteWorkflow(e),class:"text-red-600 hover:text-red-800"},l[23]||(l[23]=[(0,a.Lk)("i",{class:"fas fa-trash-alt ml-1"},null,-1),(0,a.eW)("حذف ")]),8,p)])])])))),128)),0===$.workflows.length?((0,a.uX)(),(0,a.CE)("div",b,[l[25]||(l[25]=(0,a.Lk)("i",{class:"fas fa-project-diagram text-5xl text-gray-300 mb-4"},null,-1)),l[26]||(l[26]=(0,a.Lk)("h3",{class:"text-xl font-semibold text-gray-600 mb-2"},"لا توجد مخططات بعد",-1)),l[27]||(l[27]=(0,a.Lk)("p",{class:"text-gray-500 mb-4"},"قم بإضافة مخططات سير العمل لتوثيق عملية البحث",-1)),(0,a.Lk)("button",{onClick:l[1]||(l[1]=e=>$.showAddWorkflowModal=!0),class:"btn btn-primary"},l[24]||(l[24]=[(0,a.Lk)("i",{class:"fas fa-plus ml-2"},null,-1),(0,a.eW)("إضافة مخطط جديد ")]))])):(0,a.Q3)("",!0)]),$.selectedWorkflow?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"modal-overlay",onClick:l[12]||(l[12]=(0,o.D$)(((...e)=>$.closeDetails&&$.closeDetails(...e)),["self"]))},[(0,a.Lk)("div",m,[(0,a.Lk)("div",v,[(0,a.Lk)("h2",g,(0,s.v_)($.selectedWorkflow.title),1),(0,a.Lk)("button",{onClick:l[2]||(l[2]=(...e)=>$.closeDetails&&$.closeDetails(...e)),class:"text-gray-500 hover:text-gray-700"},l[28]||(l[28]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,a.Lk)("img",{src:$.selectedWorkflow.imageUrl,alt:$.selectedWorkflow.title,class:"w-full h-64 object-contain rounded-lg mb-4"},null,8,h),(0,a.Lk)("div",y,[l[29]||(l[29]=(0,a.Lk)("label",{class:"form-label"},"العنوان",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=e=>$.selectedWorkflow.title=e),class:"form-input"},null,512),[[o.Jo,$.selectedWorkflow.title]])]),(0,a.Lk)("div",L,[l[30]||(l[30]=(0,a.Lk)("label",{class:"form-label"},"الوصف",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":l[4]||(l[4]=e=>$.selectedWorkflow.description=e),rows:"4",class:"form-input"},null,512),[[o.Jo,$.selectedWorkflow.description]])]),(0,a.Lk)("div",x,[l[31]||(l[31]=(0,a.Lk)("label",{class:"form-label"},"الملاحظات",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":l[5]||(l[5]=e=>$.selectedWorkflow.notes=e),rows:"4",class:"form-input"},null,512),[[o.Jo,$.selectedWorkflow.notes]])]),(0,a.Lk)("div",W,[l[33]||(l[33]=(0,a.Lk)("label",{class:"form-label"},"المهام المرتبطة",-1)),(0,a.Lk)("div",C,[$.selectedWorkflow.relatedTasks&&0!==$.selectedWorkflow.relatedTasks.length?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)($.selectedWorkflow.relatedTasks,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"mb-3 p-3 bg-white rounded-lg shadow-sm flex justify-between items-center"},[(0,a.Lk)("span",null,(0,s.v_)(e),1),(0,a.Lk)("button",{onClick:e=>$.removeRelatedTask(t),class:"text-red-600 text-xs hover:text-red-800"},l[32]||(l[32]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]),8,R)])))),128)):((0,a.uX)(),(0,a.CE)("div",T," لا توجد مهام مرتبطة بعد "))]),(0,a.Lk)("div",E,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":l[6]||(l[6]=e=>$.newRelatedTask=e),placeholder:"أضف مهمة مرتبطة...",class:"form-input flex-grow",onKeyup:l[7]||(l[7]=(0,o.jR)(((...e)=>$.addRelatedTask&&$.addRelatedTask(...e)),["enter"]))},null,544),[[o.Jo,$.newRelatedTask]]),(0,a.Lk)("button",{onClick:l[8]||(l[8]=(...e)=>$.addRelatedTask&&$.addRelatedTask(...e)),class:"btn btn-primary mr-2"},"إضافة")])]),(0,a.Lk)("div",K,[(0,a.Lk)("div",null,[(0,a.Lk)("button",{onClick:l[9]||(l[9]=(...e)=>$.saveWorkflowChanges&&$.saveWorkflowChanges(...e)),class:"btn btn-primary ml-2"},"حفظ التغييرات"),(0,a.Lk)("button",{onClick:l[10]||(l[10]=(...e)=>$.closeDetails&&$.closeDetails(...e)),class:"btn btn-outline"},"إلغاء")]),(0,a.Lk)("button",{onClick:l[11]||(l[11]=e=>$.deleteWorkflow($.selectedWorkflow)),class:"btn btn-danger"},"حذف المخطط")])])])):(0,a.Q3)("",!0),$.showAddWorkflowModal?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"modal-overlay",onClick:l[19]||(l[19]=(0,o.D$)((e=>$.showAddWorkflowModal=!1),["self"]))},[(0,a.Lk)("div",U,[(0,a.Lk)("div",j,[l[35]||(l[35]=(0,a.Lk)("h2",{class:"text-xl font-bold text-gray-800"},"إضافة مخطط جديد",-1)),(0,a.Lk)("button",{onClick:l[13]||(l[13]=e=>$.showAddWorkflowModal=!1),class:"text-gray-500 hover:text-gray-700"},l[34]||(l[34]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,a.Lk)("div",D,[l[36]||(l[36]=(0,a.Lk)("label",{class:"form-label"},"العنوان",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":l[14]||(l[14]=e=>$.newWorkflow.title=e),class:"form-input",required:""},null,512),[[o.Jo,$.newWorkflow.title]])]),(0,a.Lk)("div",A,[l[37]||(l[37]=(0,a.Lk)("label",{class:"form-label"},"الوصف",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":l[15]||(l[15]=e=>$.newWorkflow.description=e),rows:"4",class:"form-input",required:""},null,512),[[o.Jo,$.newWorkflow.description]])]),(0,a.Lk)("div",X,[l[38]||(l[38]=(0,a.Lk)("label",{class:"form-label"},"صورة المخطط",-1)),(0,a.Lk)("input",{type:"file",accept:"image/*",onChange:l[16]||(l[16]=(...e)=>$.handleFileUpload&&$.handleFileUpload(...e)),class:"form-input",required:""},null,32)]),(0,a.Lk)("div",_,[(0,a.Lk)("button",{onClick:l[17]||(l[17]=e=>$.showAddWorkflowModal=!1),class:"btn btn-outline ml-2"},"إلغاء"),(0,a.Lk)("button",{onClick:l[18]||(l[18]=(...e)=>$.addNewWorkflow&&$.addNewWorkflow(...e)),class:"btn btn-primary",disabled:$.isUploading},[$.isUploading?((0,a.uX)(),(0,a.CE)("i",V)):(0,a.Q3)("",!0),l[39]||(l[39]=(0,a.eW)(" إضافة المخطط "))],8,M)])])])):(0,a.Q3)("",!0)])}t(4114),t(8111),t(1701);var F=t(953),J=t(9933),P=t(5904),O={name:"Workflow",setup(){const e=(0,J.C3)(),l=(0,P.c7)(),t=(0,F.KR)([]),s=(0,F.KR)(null),o=(0,F.KR)(""),r=(0,F.KR)(!1),n=(0,F.KR)({title:"",description:"",notes:"",relatedTasks:[]}),i=(0,F.KR)(null),d=(0,F.KR)(!1),c=()=>{const l=(0,J.KR)(e,"workflows");(0,J.Zy)(l,(e=>{const l=e.val();t.value=l?Object.entries(l).map((([e,l])=>({id:e,...l,notes:l.notes||"",relatedTasks:l.relatedTasks||[]}))):[]}))},k=e=>{s.value={...e}},u=()=>{s.value=null,o.value=""},f=()=>{if(!s.value)return;const l=(0,J.KR)(e,`workflows/${s.value.id}`);(0,J.yo)(l,{title:s.value.title,description:s.value.description,notes:s.value.notes||"",relatedTasks:s.value.relatedTasks||[]}),u()},w=t=>{if(t&&confirm("هل أنت متأكد من حذف هذا المخطط؟")){if(t.storagePath){const e=(0,P.KR)(l,t.storagePath);(0,P.XR)(e).catch((e=>{console.error("Error deleting file:",e)}))}const a=(0,J.KR)(e,`workflows/${t.id}`);(0,J.TF)(a),s.value&&s.value.id===t.id&&u()}},p=()=>{o.value.trim()&&s.value&&(s.value.relatedTasks||(s.value.relatedTasks=[]),s.value.relatedTasks.push(o.value.trim()),o.value="")},b=e=>{s.value&&s.value.relatedTasks&&s.value.relatedTasks.splice(e,1)},m=e=>{i.value=e.target.files[0]},v=()=>{if(!n.value.title.trim()||!n.value.description.trim()||!i.value)return void alert("يرجى ملء جميع الحقول المطلوبة");d.value=!0;const t=i.value.name.split(".").pop(),a=`workflow_${Date.now()}.${t}`,s=`workflow_images/${a}`,o=(0,P.KR)(l,s),c=(0,P.bp)(o,i.value);c.on("state_changed",(e=>{const l=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+l+"% done")}),(e=>{console.error("Error uploading file:",e),d.value=!1,alert("حدث خطأ أثناء رفع الملف")}),(()=>{(0,P.qk)(c.snapshot.ref).then((l=>{const t=(0,J.KR)(e,"workflows");(0,J.VC)(t,{title:n.value.title,description:n.value.description,imageUrl:l,storagePath:s,timestamp:Date.now(),notes:"",relatedTasks:[]}),n.value={title:"",description:"",notes:"",relatedTasks:[]},i.value=null,d.value=!1,r.value=!1}))}))};return(0,a.sV)((()=>{c()})),{workflows:t,selectedWorkflow:s,newRelatedTask:o,showAddWorkflowModal:r,newWorkflow:n,isUploading:d,openWorkflowDetails:k,closeDetails:u,saveWorkflowChanges:f,deleteWorkflow:w,addRelatedTask:p,removeRelatedTask:b,handleFileUpload:m,addNewWorkflow:v}}},q=t(6262);const Q=(0,q.A)(O,[["render",$]]);var N=Q}}]);
//# sourceMappingURL=889.0646bb6d.js.map