"use strict";(self["webpackChunkresearch_task_manager"]=self["webpackChunkresearch_task_manager"]||[]).push([[925],{5925:function(e,t,l){l.r(t),l.d(t,{default:function(){return te}});var a=l(641),s=l(33),r=l(3751);const o={class:"fade-in"},n={class:"flex justify-between items-center mb-6"},d={class:"flex space-x-2 space-x-reverse"},c={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},i={class:"bg-white rounded-lg shadow-md p-6"},u={key:0,class:"text-center py-8 text-gray-500"},p={key:1,class:"space-y-4"},k={class:"font-medium text-gray-800"},m={class:"text-sm text-gray-500"},L={class:"flex items-center"},f=["href"],g=["onClick"],b={class:"bg-white rounded-lg shadow-md p-6"},v={key:0,class:"text-center py-8 text-gray-500"},h={key:1,class:"space-y-4"},x={class:"font-medium text-gray-800"},y={class:"text-sm text-gray-500"},C={class:"flex items-center"},w=["href"],D=["onClick"],_={class:"bg-white rounded-lg shadow-md p-6 mt-6"},P={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},E={class:"p-4 bg-gray-50 rounded-lg"},K={class:"text-2xl font-bold text-primary-600"},M={class:"p-4 bg-gray-50 rounded-lg"},R={class:"text-2xl font-bold text-primary-600"},X={class:"p-4 bg-gray-50 rounded-lg"},A={class:"text-2xl font-bold text-primary-600"},U={class:"p-4 bg-gray-50 rounded-lg"},F={class:"text-2xl font-bold text-primary-600"},j={class:"modal-content"},W={class:"flex justify-between items-center mb-4"},$={class:"mb-4"},T={class:"flex justify-end"},q=["disabled"],Q={key:0,class:"fas fa-spinner fa-spin ml-1"},V={class:"modal-content"},B={class:"flex justify-between items-center mb-4"},I={class:"mb-4"},O={class:"flex justify-end"},Z=["disabled"],G={key:0,class:"fas fa-spinner fa-spin ml-1"};function S(e,t,l,S,z,H){return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",n,[t[14]||(t[14]=(0,a.Lk)("h1",{class:"text-2xl font-bold text-gray-800"},"الخطابات والموافقات",-1)),(0,a.Lk)("div",d,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>S.showAddDoctorLetterModal=!0),class:"btn btn-primary ml-2"},t[12]||(t[12]=[(0,a.Lk)("i",{class:"fas fa-plus ml-2"},null,-1),(0,a.eW)("إضافة موافقة دكتور ")])),(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>S.showAddParentLetterModal=!0),class:"btn btn-secondary"},t[13]||(t[13]=[(0,a.Lk)("i",{class:"fas fa-plus ml-2"},null,-1),(0,a.eW)("إضافة موافقة ولي أمر ")]))])]),(0,a.Lk)("div",c,[(0,a.Lk)("div",i,[t[17]||(t[17]=(0,a.Lk)("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"موافقات الدكاترة",-1)),0===S.doctorLetters.length?((0,a.uX)(),(0,a.CE)("div",u," لا توجد موافقات دكاترة حتى الآن ")):((0,a.uX)(),(0,a.CE)("div",p,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.doctorLetters,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"bg-gray-50 rounded-lg p-4 flex justify-between items-center"},[(0,a.Lk)("div",null,[(0,a.Lk)("h3",k,(0,s.v_)(e.name),1),(0,a.Lk)("p",m,(0,s.v_)(S.formatDate(e.timestamp)),1)]),(0,a.Lk)("div",L,[(0,a.Lk)("a",{href:e.url,target:"_blank",class:"text-primary-600 hover:text-primary-800 ml-4"},t[15]||(t[15]=[(0,a.Lk)("i",{class:"fas fa-external-link-alt ml-1"},null,-1),(0,a.eW)("عرض ")]),8,f),(0,a.Lk)("button",{onClick:t=>S.deleteLetter("doctor",e),class:"text-red-600 hover:text-red-800"},t[16]||(t[16]=[(0,a.Lk)("i",{class:"fas fa-trash-alt"},null,-1)]),8,g)])])))),128))]))]),(0,a.Lk)("div",b,[t[20]||(t[20]=(0,a.Lk)("h2",{class:"text-xl font-bold text-gray-800 mb-4"}," موافقات أولياء الأمور ",-1)),0===S.parentLetters.length?((0,a.uX)(),(0,a.CE)("div",v," لا توجد موافقات أولياء أمور حتى الآن ")):((0,a.uX)(),(0,a.CE)("div",h,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.parentLetters,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"bg-gray-50 rounded-lg p-4 flex justify-between items-center"},[(0,a.Lk)("div",null,[(0,a.Lk)("h3",x,(0,s.v_)(e.name),1),(0,a.Lk)("p",y,(0,s.v_)(S.formatDate(e.timestamp)),1)]),(0,a.Lk)("div",C,[(0,a.Lk)("a",{href:e.url,target:"_blank",class:"text-primary-600 hover:text-primary-800 ml-4"},t[18]||(t[18]=[(0,a.Lk)("i",{class:"fas fa-external-link-alt ml-1"},null,-1),(0,a.eW)("عرض ")]),8,w),(0,a.Lk)("button",{onClick:t=>S.deleteLetter("parent",e),class:"text-red-600 hover:text-red-800"},t[19]||(t[19]=[(0,a.Lk)("i",{class:"fas fa-trash-alt"},null,-1)]),8,D)])])))),128))]))])]),(0,a.Lk)("div",_,[t[25]||(t[25]=(0,a.Lk)("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"حالة الموافقات",-1)),(0,a.Lk)("div",P,[(0,a.Lk)("div",E,[t[21]||(t[21]=(0,a.Lk)("h3",{class:"font-semibold text-gray-700 mb-2"}," إجمالي موافقات الدكاترة ",-1)),(0,a.Lk)("p",K,(0,s.v_)(S.doctorLetters.length),1)]),(0,a.Lk)("div",M,[t[22]||(t[22]=(0,a.Lk)("h3",{class:"font-semibold text-gray-700 mb-2"}," إجمالي موافقات أولياء الأمور ",-1)),(0,a.Lk)("p",R,(0,s.v_)(S.parentLetters.length),1)]),(0,a.Lk)("div",X,[t[23]||(t[23]=(0,a.Lk)("h3",{class:"font-semibold text-gray-700 mb-2"}," نسبة اكتمال موافقات الدكاترة ",-1)),(0,a.Lk)("p",A,(0,s.v_)(S.doctorCompletionPercentage)+"% ",1)]),(0,a.Lk)("div",U,[t[24]||(t[24]=(0,a.Lk)("h3",{class:"font-semibold text-gray-700 mb-2"}," نسبة اكتمال موافقات أولياء الأمور ",-1)),(0,a.Lk)("p",F,(0,s.v_)(S.parentCompletionPercentage)+"% ",1)])])]),S.showAddDoctorLetterModal?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"modal-overlay",onClick:t[6]||(t[6]=(0,r.D$)((e=>S.showAddDoctorLetterModal=!1),["self"]))},[(0,a.Lk)("div",j,[(0,a.Lk)("div",W,[t[27]||(t[27]=(0,a.Lk)("h2",{class:"text-xl font-bold text-gray-800"},"إضافة موافقة دكتور",-1)),(0,a.Lk)("button",{onClick:t[2]||(t[2]=e=>S.showAddDoctorLetterModal=!1),class:"text-gray-500 hover:text-gray-700"},t[26]||(t[26]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,a.Lk)("div",$,[t[28]||(t[28]=(0,a.Lk)("label",{class:"form-label"},"ملف الموافقة (PDF)",-1)),(0,a.Lk)("input",{type:"file",accept:"application/pdf",onChange:t[3]||(t[3]=(...e)=>S.handleDoctorFileUpload&&S.handleDoctorFileUpload(...e)),class:"form-input",required:""},null,32)]),(0,a.Lk)("div",T,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>S.showAddDoctorLetterModal=!1),class:"btn btn-outline ml-2"}," إلغاء "),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>S.uploadDoctorLetter&&S.uploadDoctorLetter(...e)),class:"btn btn-primary",disabled:S.isUploading},[S.isUploading?((0,a.uX)(),(0,a.CE)("i",Q)):(0,a.Q3)("",!0),t[29]||(t[29]=(0,a.eW)(" رفع الملف "))],8,q)])])])):(0,a.Q3)("",!0),S.showAddParentLetterModal?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"modal-overlay",onClick:t[11]||(t[11]=(0,r.D$)((e=>S.showAddParentLetterModal=!1),["self"]))},[(0,a.Lk)("div",V,[(0,a.Lk)("div",B,[t[31]||(t[31]=(0,a.Lk)("h2",{class:"text-xl font-bold text-gray-800"},"إضافة موافقة ولي أمر",-1)),(0,a.Lk)("button",{onClick:t[7]||(t[7]=e=>S.showAddParentLetterModal=!1),class:"text-gray-500 hover:text-gray-700"},t[30]||(t[30]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,a.Lk)("div",I,[t[32]||(t[32]=(0,a.Lk)("label",{class:"form-label"},"ملف الموافقة (PDF)",-1)),(0,a.Lk)("input",{type:"file",accept:"application/pdf",onChange:t[8]||(t[8]=(...e)=>S.handleParentFileUpload&&S.handleParentFileUpload(...e)),class:"form-input",required:""},null,32)]),(0,a.Lk)("div",O,[(0,a.Lk)("button",{onClick:t[9]||(t[9]=e=>S.showAddParentLetterModal=!1),class:"btn btn-outline ml-2"}," إلغاء "),(0,a.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>S.uploadParentLetter&&S.uploadParentLetter(...e)),class:"btn btn-primary",disabled:S.isUploading},[S.isUploading?((0,a.uX)(),(0,a.CE)("i",G)):(0,a.Q3)("",!0),t[33]||(t[33]=(0,a.eW)(" رفع الملف "))],8,Z)])])])):(0,a.Q3)("",!0)])}l(8111),l(1701);var z=l(953),H=l(9933),J=l(5904),N={name:"Letters",setup(){const e=(0,H.C3)(),t=(0,J.c7)(),l=(0,z.KR)([]),s=(0,z.KR)([]),r=(0,z.KR)(!1),o=(0,z.KR)(!1),n=(0,z.KR)(null),d=(0,z.KR)(null),c=(0,z.KR)(!1),i=()=>{const t=(0,H.KR)(e,"doctor_letters");(0,H.Zy)(t,(e=>{const t=e.val();l.value=t?Object.entries(t).map((([e,t])=>({id:e,...t}))):[]}));const a=(0,H.KR)(e,"parent_letters");(0,H.Zy)(a,(e=>{const t=e.val();s.value=t?Object.entries(t).map((([e,t])=>({id:e,...t}))):[]}))},u=(0,a.EW)((()=>{const e=5;return Math.min(Math.round(l.value.length/e*100),100)})),p=(0,a.EW)((()=>{const e=10;return Math.min(Math.round(s.value.length/e*100),100)})),k=e=>{n.value=e.target.files[0]},m=e=>{d.value=e.target.files[0]},L=()=>{if(!n.value)return void alert("يرجى اختيار ملف");c.value=!0;const l=n.value.name,a=`doctor_letters/${l}`,s=(0,J.KR)(t,a),o=(0,J.bp)(s,n.value);o.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+t+"% done")}),(e=>{console.error("Error uploading file:",e),c.value=!1,alert("حدث خطأ أثناء رفع الملف")}),(()=>{(0,J.qk)(o.snapshot.ref).then((t=>{const s=(0,H.KR)(e,"doctor_letters");(0,H.VC)(s,{name:l,url:t,storagePath:a,timestamp:Date.now()}),n.value=null,c.value=!1,r.value=!1}))}))},f=()=>{if(!d.value)return void alert("يرجى اختيار ملف");c.value=!0;const l=d.value.name,a=`parent_letters/${l}`,s=(0,J.KR)(t,a),r=(0,J.bp)(s,d.value);r.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+t+"% done")}),(e=>{console.error("Error uploading file:",e),c.value=!1,alert("حدث خطأ أثناء رفع الملف")}),(()=>{(0,J.qk)(r.snapshot.ref).then((t=>{const s=(0,H.KR)(e,"parent_letters");(0,H.VC)(s,{name:l,url:t,storagePath:a,timestamp:Date.now()}),d.value=null,c.value=!1,o.value=!1}))}))},g=(l,a)=>{if(!confirm("هل أنت متأكد من حذف هذا الملف؟"))return;const s=(0,J.KR)(t,a.storagePath);(0,J.XR)(s).catch((e=>{console.error("Error deleting file:",e)}));const r=(0,H.KR)(e,`${l}_letters/${a.id}`);(0,H.TF)(r)},b=()=>{alert("سيتم تنزيل نموذج موافقة الدكاترة (هذه وظيفة تجريبية)")},v=()=>{alert("سيتم تنزيل نموذج موافقة أولياء الأمور (هذه وظيفة تجريبية)")},h=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleDateString("ar-EG")};return(0,a.sV)((()=>{i()})),{doctorLetters:l,parentLetters:s,showAddDoctorLetterModal:r,showAddParentLetterModal:o,isUploading:c,doctorCompletionPercentage:u,parentCompletionPercentage:p,handleDoctorFileUpload:k,handleParentFileUpload:m,uploadDoctorLetter:L,uploadParentLetter:f,deleteLetter:g,downloadDoctorTemplate:b,downloadParentTemplate:v,formatDate:h}}},Y=l(6262);const ee=(0,Y.A)(N,[["render",S]]);var te=ee}}]);